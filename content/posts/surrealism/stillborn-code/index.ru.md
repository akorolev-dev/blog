---
title: "Не уверен в значении слова сюр, но это он..."
date: 2024-03-21T22:55:13+04:00
draft: false
description: "Подумал я, рассматривая историю коммитов в git."
noindex: false
featured: false
pinned: false
comments: true
slug: stillborn-code
series:
  - surrealism
categories:
  - reflections
tags:
  - liquibase
images:
  - alex-shuper-Jp1zukEDAYo-unsplash-crop.jpg
---
Проверяя микросервис после миграции на Java 17 и Spring Boot 3, я вдруг обнаружил полностью пустую {{< abbr "БД" >}}.
Выполнение такой задачи человеком, не имеющим никакого отношения к созданию и поддержке функционала, является хорошим началом для увлекательной истории.

Приложение, которое не хочет стартовать без подключения, но при этом и не создает ни одного объекта, выглядело очень подозрительным.
В pom.xml был и стартер для {{< abbr "JPA" >}}, и дополнительные библиотеки для Hibernate.
В конфигурации путь до файла с журналом изменений {{< abbr "Liquibase" >}}, который в свою очередь включал директорию с форматированными sql.

Запуск приложения в debug режиме бескомпромиссно сообщил, что `LiquibaseAutoConfiguration` не активен из-за отсутствия класса `liquibase.change.DatabaseChange`.
Да, набор pom.xml многомодульного проекта содержал многое, что-то умудрялись объявить два, а то и три раза.
Но вот `org.liquibase:liquibase-core` среди всего этого не завалялось.

Первой мыслью было, что зависимость либо удалили, либо случайно потеряли на каком-то разрешении конфликтов.
Добавил артефакт, пересобрал, запустил и получил ошибку `liquibase.exception.ChangeLogParseException: classpath:/db.changelog/master.yaml does not exist`.

Знаете, как InteliiiJ IDEA вложенные директории объединяет через точку, чтобы не плодить лишние уровни в интерфейсе структуры проекта?
Вот это было очень похоже на причину ошибки в конфигурации микросервиса, которая спрятала нужный ресурс в `db/changelog`.
Кто-то набрал текст, ориентируясь сугубо на надпись в интерфейсе.

Удивлением номер два стало, что настройки созданы еще в мае прошлого года и за прошедшие 10 месяцев не менялись.
При этом миграции были дополнены несколькими новыми sql-скриптами полтора и два месяца назад.
То есть миграции гарантированно не работали изначально, и потом их еще дважды дополняли наборами изменений схемы, но пустая база так никого и не смутила.

Последняя надежда оставалась на историю из серии "Открыть ворота! Закрыть ворота!".
Что-то реализовали, потом решили отказаться, но не торопились убирать мертвый код.
Но реальность превзошла ожидания и тут, команда оказалась не в курсе проблемы.

Вот теперь думаю, как мне могут прокомментировать информацию, что контейнер сервлетов в веб-приложении с {{< abbr "REST" >}} {{< abbr "API" >}} добавляется только по причине подключения api-библиотеки, которая транзитивно добавляет другую api-библиотеку, а только она зачем-то сильно хочет Apache Tomcat.

Говорят, что во всём надо искать свои плюсы?
Согласен. Теперь когда не работает какое-то приложение, я просто вспоминаю людей, которые могли успеть поучаствовать в его реализации...

{{% bs/alert secondary %}}
Источник изображения в заголовке Unsplash. Автор [Alex Shuper](https://unsplash.com/@alexshuperart).
{{% /bs/alert %}}
